@prefix cwl: <https://w3id.org/cwl/cwl#> .
@prefix dct: <http://purl.org/dc/terms/> .
@prefix ns1: <rdf:> .
@prefix ns2: <s:> .
@prefix ogcproc: <http://www.opengis.net/def/ogcapi/processes/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

[] cwl:cwlVersion <file:///github/workspace/v1.0> ;
    cwl:graph [ rdfs:label "Water bodies detection based on NDWI and otsu threshold"^^xsd:string ;
            dct:identifier <file:///github/workspace/water-bodies> ;
            ogcproc:input _:N770b149b9d87482fbc36a9f392331ac2 ;
            ogcproc:output _:Nbd7eb32de03149b9b13c1908de74a20b ;
            rdfs:comment "Water bodies detection based on NDWI and otsu threshold applied to Sentinel-2 COG STAC items"^^xsd:string ;
            cwl:input _:N770b149b9d87482fbc36a9f392331ac2 ;
            cwl:output _:Nbd7eb32de03149b9b13c1908de74a20b ;
            cwl:requirements [ ns1:type <file:///github/workspace/ScatterFeatureRequirement> ],
                [ ns1:type <file:///github/workspace/SubworkflowFeatureRequirement> ],
                [ cwl:types [ cwl:import <https://raw.githubusercontent.com/eoap/schemas/main/stac.yaml> ] ;
                    ns1:type <file:///github/workspace/SchemaDefRequirement> ] ;
            cwl:steps [ cwl:node_stac [ cwl:in [ cwl:item "stac_items" ;
                                    cwl:rasters [ cwl:source <file:///github/workspace/node_water_bodies/detected_water_body> ] ] ;
                            cwl:out ( "stac_catalog" ) ;
                            cwl:run <file:///github/workspace/#stac> ] ;
                    cwl:node_water_bodies [ cwl:in [ cwl:aoi "aoi" ;
                                    cwl:bands "bands" ;
                                    cwl:epsg "epsg" ;
                                    cwl:item "stac_items" ] ;
                            cwl:out ( "detected_water_body" ) ;
                            cwl:run <file:///github/workspace/#detect_water_body> ;
                            cwl:scatter ( "item" ) ;
                            cwl:scatterMethod <file:///github/workspace/dotproduct> ] ] ;
            ns1:type <file:///github/workspace/Workflow> ],
        [ dct:identifier <file:///github/workspace/crop> ;
            ogcproc:input _:N2b771978d48343e9a74c6396abf3cfc4 ;
            ogcproc:output _:N349569651688402db101fc0fef7b3bb7 ;
            cwl:arguments () ;
            cwl:baseCommand "[\"python\",\"-m\",\"app\"]"^^rdf:JSON ;
            cwl:hints [ cwl:DockerRequirement [ cwl:dockerPull "cr.terradue.com/earthquake-monitoring/crop:latest"^^xsd:string ] ] ;
            cwl:input _:N2b771978d48343e9a74c6396abf3cfc4 ;
            cwl:output _:N349569651688402db101fc0fef7b3bb7 ;
            cwl:requirements [ cwl:EnvVarRequirement [ cwl:envDef [ cwl:PATH "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ;
                                    cwl:PYTHONPATH "/app" ] ] ;
                    cwl:InlineJavascriptRequirement [ ] ;
                    cwl:ResourceRequirement [ cwl:coresMax 1 ;
                            cwl:ramMax 512 ] ] ;
            ns1:type <file:///github/workspace/CommandLineTool> ],
        [ dct:identifier <file:///github/workspace/norm_diff> ;
            ogcproc:input _:Nbcce4f2d169a459fb5b5450fa81bda1b ;
            ogcproc:output _:Nb2782d9823d041d4a6d52b0a9e6ae60a ;
            cwl:arguments () ;
            cwl:baseCommand "[\"python\",\"-m\",\"app\"]"^^rdf:JSON ;
            cwl:hints [ cwl:DockerRequirement [ cwl:dockerPull "cr.terradue.com/earthquake-monitoring/norm_diff:latest"^^xsd:string ] ] ;
            cwl:input _:Nbcce4f2d169a459fb5b5450fa81bda1b ;
            cwl:output _:Nb2782d9823d041d4a6d52b0a9e6ae60a ;
            cwl:requirements [ cwl:EnvVarRequirement [ cwl:envDef [ cwl:PATH "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ;
                                    cwl:PYTHONPATH "/app" ] ] ;
                    cwl:InlineJavascriptRequirement [ ] ;
                    cwl:ResourceRequirement [ cwl:coresMax 1 ;
                            cwl:ramMax 512 ] ] ;
            ns1:type <file:///github/workspace/CommandLineTool> ],
        [ dct:identifier <file:///github/workspace/otsu> ;
            ogcproc:input _:N29d9e9503516429580cfca5bdc85888f ;
            ogcproc:output _:N0ccded199132450e8e50bfe25832a08a ;
            cwl:arguments () ;
            cwl:baseCommand "[\"python\",\"-m\",\"app\"]"^^rdf:JSON ;
            cwl:hints [ cwl:DockerRequirement [ cwl:dockerPull "cr.terradue.com/earthquake-monitoring/otsu:latest"^^xsd:string ] ] ;
            cwl:input _:N29d9e9503516429580cfca5bdc85888f ;
            cwl:output _:N0ccded199132450e8e50bfe25832a08a ;
            cwl:requirements [ cwl:EnvVarRequirement [ cwl:envDef [ cwl:PATH "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ;
                                    cwl:PYTHONPATH "/app" ] ] ;
                    cwl:InlineJavascriptRequirement [ ] ;
                    cwl:ResourceRequirement [ cwl:coresMax 1 ;
                            cwl:ramMax 512 ] ] ;
            ns1:type <file:///github/workspace/CommandLineTool> ],
        [ rdfs:label "Water body detection based on NDWI and otsu threshold"^^xsd:string ;
            dct:identifier <file:///github/workspace/detect_water_body> ;
            ogcproc:input _:N563c03302abc4f9b8caaecf98021c4cf ;
            ogcproc:output _:Na9d39125805643e09ea4bd42effeaa2c ;
            rdfs:comment "Water body detection based on NDWI and otsu threshold"^^xsd:string ;
            cwl:input _:N563c03302abc4f9b8caaecf98021c4cf ;
            cwl:output _:Na9d39125805643e09ea4bd42effeaa2c ;
            cwl:requirements [ ns1:type <file:///github/workspace/ScatterFeatureRequirement> ] ;
            cwl:steps [ cwl:node_crop [ cwl:in [ cwl:aoi "aoi" ;
                                    cwl:band "bands" ;
                                    cwl:epsg "epsg" ;
                                    cwl:item "item" ] ;
                            cwl:out ( "cropped" ) ;
                            cwl:run <file:///github/workspace/#crop> ;
                            cwl:scatter ( "band" ) ;
                            cwl:scatterMethod <file:///github/workspace/dotproduct> ] ;
                    cwl:node_normalized_difference [ cwl:in [ cwl:rasters [ cwl:source <file:///github/workspace/node_crop/cropped> ] ] ;
                            cwl:out ( "ndwi" ) ;
                            cwl:run <file:///github/workspace/#norm_diff> ] ;
                    cwl:node_otsu [ cwl:in [ cwl:raster [ cwl:source <file:///github/workspace/node_normalized_difference/ndwi> ] ] ;
                            cwl:out ( "binary_mask_item" ) ;
                            cwl:run <file:///github/workspace/#otsu> ] ] ;
            ns1:type <file:///github/workspace/Workflow> ],
        [ dct:identifier <file:///github/workspace/stac> ;
            ogcproc:input _:Na28fe05711dd4903ac84c8749022b431 ;
            ogcproc:output _:N8bf9e2ad31b64aa1a2b8f0054ef8c5ca ;
            cwl:arguments () ;
            cwl:baseCommand "[\"python\",\"-m\",\"app\"]"^^rdf:JSON ;
            cwl:hints [ cwl:DockerRequirement [ cwl:dockerPull "cr.terradue.com/earthquake-monitoring/stac:latest"^^xsd:string ] ] ;
            cwl:input _:Na28fe05711dd4903ac84c8749022b431 ;
            cwl:output _:N8bf9e2ad31b64aa1a2b8f0054ef8c5ca ;
            cwl:requirements [ cwl:EnvVarRequirement [ cwl:envDef [ cwl:PATH "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin" ;
                                    cwl:PYTHONPATH "/app" ] ] ;
                    cwl:InlineJavascriptRequirement [ ] ;
                    cwl:ResourceRequirement [ cwl:coresMax 1 ;
                            cwl:ramMax 512 ] ] ;
            ns1:type <file:///github/workspace/CommandLineTool> ] ;
    cwl:namespaces "{\"s\":\"https://schema.org/\"}"^^rdf:JSON ;
    cwl:schemas "http://schema.org/version/9.0/schemaorg-current-http.rdf" ;
    ns2:softwareVersion "1.4.1" .

_:N0c06dd9d798a424a8a396830c506aa41 cwl:binary_mask_item [ cwl:outputBinding [ cwl:glob "*.tif"^^xsd:string ] ;
            cwl:type <file:///github/workspace/File> ] .

_:N0c825bb4a6b74ad6b50d1dcd813accaa cwl:prefix "--epsg"^^xsd:string .

_:N0feb7fa893c54aabb7d8a33bafd7f0ec cwl:glob "."^^xsd:string .

_:N1352d756793c4f93a41b9cdcfc34d58d rdfs:comment "EPSG code"^^xsd:string ;
    cwl:default "\"EPSG:4326\""^^rdf:JSON ;
    cwl:type <file:///github/workspace/string> .

_:N229e9727dcf14a4d9084cf9b6bbdaee8 cwl:outputBinding _:N0feb7fa893c54aabb7d8a33bafd7f0ec ;
    cwl:type <file:///github/workspace/Directory> .

_:N253e78e4cfe243eb85afc43afae2b75b cwl:inputBinding [ cwl:prefix "--input-item"^^xsd:string ] ;
    cwl:type <file:///github/workspace/string> .

_:N29587e2601b54a4faa92b811a0ae57fd dct:identifier <file:///github/workspace/detected_water_body> ;
    cwl:outputSource <file:///github/workspace/node_otsu/binary_mask_item> ;
    cwl:type <file:///github/workspace/File> .

_:N2ef3beadf3c54a5e84ee1997547e14f4 rdfs:comment "area of interest as a bounding box"^^xsd:string ;
    cwl:type <file:///github/workspace/string> .

_:N314a62cedd4441158ed14bb8e5d95f79 cwl:prefix "--water-body"^^xsd:string .

_:N377581efd5fb41a789a8c5ef77071398 cwl:inputBinding _:N314a62cedd4441158ed14bb8e5d95f79 ;
    cwl:items <file:///github/workspace/File> ;
    cwl:type <file:///github/workspace/array> .

_:N392e05b7ddfa47c990f7a6d5991ce425 cwl:stac_catalog _:N229e9727dcf14a4d9084cf9b6bbdaee8 .

_:N42e7e64895a5440689b02235999d1060 cwl:inputBinding [ cwl:prefix "--input-item"^^xsd:string ] ;
    cwl:items <file:///github/workspace/string> ;
    cwl:type <file:///github/workspace/array> .

_:N476048a222e8404da4ecd1e373340e09 cwl:inputBinding [ cwl:prefix "--aoi"^^xsd:string ] ;
    cwl:type <file:///github/workspace/string> .

_:N5175c230705b4e2595512c243ae743a2 cwl:raster [ cwl:inputBinding [ cwl:position "1"^^xsd:int ] ;
            cwl:type <file:///github/workspace/File> ] .

_:N5fa14acb128c49fc9b08051086207524 rdfs:label "Sentinel-2 STAC items"^^xsd:string ;
    rdfs:comment "list of Sentinel-2 COG STAC items"^^xsd:string ;
    cwl:type <file:///github/workspace/string[]> .

_:N606e7c41550a4793b427efc10571b56b cwl:inputBinding _:N0c825bb4a6b74ad6b50d1dcd813accaa ;
    cwl:type <file:///github/workspace/string> .

_:N6387b3c5e1ee4e0c85de6ec8f47ab930 cwl:position "1"^^xsd:int .

_:N64c73293d4ef430a83c668d53cf42529 cwl:prefix "--band"^^xsd:string .

_:N666a2c25f8d644348014b590d7fc6772 rdfs:label "area of interest"^^xsd:string ;
    rdfs:comment "area of interest as a bounding box"^^xsd:string ;
    cwl:type <file:///github/workspace/string> .

_:N673bbd2fc3bb48b992b9fd7ff0605486 cwl:type _:N377581efd5fb41a789a8c5ef77071398 .

_:N704cf0bb36834a009ee131c596789196 cwl:item [ cwl:type _:N42e7e64895a5440689b02235999d1060 ] ;
    cwl:rasters _:N673bbd2fc3bb48b992b9fd7ff0605486 .

_:N793f89d9bf1640159d05c2f60591724f cwl:rasters [ cwl:inputBinding _:N6387b3c5e1ee4e0c85de6ec8f47ab930 ;
            cwl:type <file:///github/workspace/File[]> ] .

_:N80a14e5e120645a6b9198ae1e8270483 cwl:outputBinding [ cwl:glob "*.tif"^^xsd:string ] ;
    cwl:type <file:///github/workspace/File> .

_:N84ee5e6d52924ad79d0f488afff216bf cwl:inputBinding _:N64c73293d4ef430a83c668d53cf42529 ;
    cwl:type <file:///github/workspace/string> .

_:N97b7062025904b8385f14ebf6f4bfdca cwl:aoi _:N476048a222e8404da4ecd1e373340e09 ;
    cwl:band _:N84ee5e6d52924ad79d0f488afff216bf ;
    cwl:epsg _:N606e7c41550a4793b427efc10571b56b ;
    cwl:item _:N253e78e4cfe243eb85afc43afae2b75b .

_:N98905b983bdf4e029c7489ed2ea812e2 cwl:cropped [ cwl:outputBinding [ cwl:glob "*.tif"^^xsd:string ] ;
            cwl:type <file:///github/workspace/File> ] .

_:N9d5ef109547349f7ac6e09770faaff68 cwl:aoi _:N2ef3beadf3c54a5e84ee1997547e14f4 ;
    cwl:bands [ rdfs:comment "bands used for the NDWI"^^xsd:string ;
            cwl:type <file:///github/workspace/string[]> ] ;
    cwl:epsg _:N1352d756793c4f93a41b9cdcfc34d58d ;
    cwl:item [ rdfs:comment "STAC item"^^xsd:string ;
            cwl:type <file:///github/workspace/string> ] .

_:Nac98413eb72247bd8750a07ff2b753f1 cwl:ndwi _:N80a14e5e120645a6b9198ae1e8270483 .

_:Nbea88fe5307f41caa469645bd6c04c43 cwl:aoi _:N666a2c25f8d644348014b590d7fc6772 ;
    cwl:bands [ rdfs:label "bands used for the NDWI"^^xsd:string ;
            rdfs:comment "bands used for the NDWI"^^xsd:string ;
            cwl:default "[\"green\",\"nir\"]"^^rdf:JSON ;
            cwl:type <file:///github/workspace/string[]> ] ;
    cwl:epsg [ rdfs:label "EPSG code"^^xsd:string ;
            rdfs:comment "EPSG code"^^xsd:string ;
            cwl:default "\"EPSG:4326\""^^rdf:JSON ;
            cwl:type <file:///github/workspace/string> ] ;
    cwl:stac_items _:N5fa14acb128c49fc9b08051086207524 .

_:Ne56868a03f7f4a8f8a0bd5c118c86f3f dct:identifier <file:///github/workspace/stac_catalog> ;
    cwl:outputSource <file:///github/workspace/node_stac/stac_catalog> ;
    cwl:type <file:///github/workspace/Directory> .

_:N0ccded199132450e8e50bfe25832a08a a ogcproc:OutputDescription ;
    rdf:first _:N0c06dd9d798a424a8a396830c506aa41 ;
    rdf:rest () .

_:N29d9e9503516429580cfca5bdc85888f a ogcproc:InputDescription ;
    rdf:first _:N5175c230705b4e2595512c243ae743a2 ;
    rdf:rest () .

_:N2b771978d48343e9a74c6396abf3cfc4 a ogcproc:InputDescription ;
    rdf:first _:N97b7062025904b8385f14ebf6f4bfdca ;
    rdf:rest () .

_:N349569651688402db101fc0fef7b3bb7 a ogcproc:OutputDescription ;
    rdf:first _:N98905b983bdf4e029c7489ed2ea812e2 ;
    rdf:rest () .

_:N563c03302abc4f9b8caaecf98021c4cf a ogcproc:InputDescription ;
    rdf:first _:N9d5ef109547349f7ac6e09770faaff68 ;
    rdf:rest () .

_:N770b149b9d87482fbc36a9f392331ac2 a ogcproc:InputDescription ;
    rdf:first _:Nbea88fe5307f41caa469645bd6c04c43 ;
    rdf:rest () .

_:N8bf9e2ad31b64aa1a2b8f0054ef8c5ca a ogcproc:OutputDescription ;
    rdf:first _:N392e05b7ddfa47c990f7a6d5991ce425 ;
    rdf:rest () .

_:Na28fe05711dd4903ac84c8749022b431 a ogcproc:InputDescription ;
    rdf:first _:N704cf0bb36834a009ee131c596789196 ;
    rdf:rest () .

_:Na9d39125805643e09ea4bd42effeaa2c a ogcproc:OutputDescription ;
    rdf:first _:N29587e2601b54a4faa92b811a0ae57fd ;
    rdf:rest () .

_:Nb2782d9823d041d4a6d52b0a9e6ae60a a ogcproc:OutputDescription ;
    rdf:first _:Nac98413eb72247bd8750a07ff2b753f1 ;
    rdf:rest () .

_:Nbcce4f2d169a459fb5b5450fa81bda1b a ogcproc:InputDescription ;
    rdf:first _:N793f89d9bf1640159d05c2f60591724f ;
    rdf:rest () .

_:Nbd7eb32de03149b9b13c1908de74a20b a ogcproc:OutputDescription ;
    rdf:first _:Ne56868a03f7f4a8f8a0bd5c118c86f3f ;
    rdf:rest () .

